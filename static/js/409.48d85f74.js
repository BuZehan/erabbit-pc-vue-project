"use strict";(self["webpackChunkerabbit_pc_vue_project"]=self["webpackChunkerabbit_pc_vue_project"]||[]).push([[409],{4689:function(e,a,o){o.r(a),o.d(a,{default:function(){return we}});var l=o(3396),s=o(7139);const c=e=>((0,l.dD)("data-v-39cb7edc"),e=e(),(0,l.Cn)(),e),n={key:0,class:"container"},t=c((()=>(0,l._)("div",{class:"unbind"},[(0,l._)("div",{class:"loading"})],-1))),i=[t],r={key:1,class:"container"},u={class:"tab"},d=c((()=>(0,l._)("i",{class:"iconfont icon-bind"},null,-1))),m=c((()=>(0,l._)("span",null,"已有小兔鲜账号，请绑定手机",-1))),p=[d,m],v=c((()=>(0,l._)("i",{class:"iconfont icon-edit"},null,-1))),f=c((()=>(0,l._)("span",null,"没有小兔鲜账号，请完善资料",-1))),_=[v,f],b={key:0,class:"tab-content"},k={key:1,class:"tab-content"};function h(e,a,o,c,t,d){const m=(0,l.up)("LoginHeader"),v=(0,l.up)("CallbackBind"),f=(0,l.up)("CallbackPatch"),h=(0,l.up)("LoginFooter");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Uk)("联合登录")])),_:1}),c.isBind?((0,l.wg)(),(0,l.iD)("section",n,i)):((0,l.wg)(),(0,l.iD)("section",r,[(0,l._)("nav",u,[(0,l._)("a",{onClick:a[0]||(a[0]=e=>c.hasAccount=!0),class:(0,s.C_)({active:c.hasAccount}),href:"javascript:;"},p,2),(0,l._)("a",{onClick:a[1]||(a[1]=e=>c.hasAccount=!1),class:(0,s.C_)({active:!c.hasAccount}),href:"javascript:;"},_,2)]),c.hasAccount?((0,l.wg)(),(0,l.iD)("div",b,[(0,l.Wm)(v,{nickname:c.nickname,avatar:c.avatar,unionId:c.unionId},null,8,["nickname","avatar","unionId"])])):((0,l.wg)(),(0,l.iD)("div",k,[(0,l.Wm)(f,{unionId:c.unionId},null,8,["unionId"])]))])),(0,l.Wm)(h)],64)}o(7658);var w=o(9716),g=o.n(w),y=o(2900),C=o(4870),x=o(7406),V=o(8867);const D=e=>((0,l.dD)("data-v-2b3c2558"),e=e(),(0,l.Cn)(),e),I={class:"user-info"},F=["src"],H={class:"xtx-form-item"},U={class:"field"},q=D((()=>(0,l._)("i",{class:"icon iconfont icon-phone"},null,-1))),Z={key:0,class:"error"},P={class:"xtx-form-item"},W={class:"field"},j=D((()=>(0,l._)("i",{class:"icon iconfont icon-code"},null,-1))),z={key:0,class:"error"};function A(e,a,o,c,n,t){const i=(0,l.up)("Field"),r=(0,l.up)("Form");return(0,l.wg)(),(0,l.j4)(r,{ref:"formCom","validation-schema":c.mySchema,autocomplete:"off",class:"xtx-form"},{default:(0,l.w5)((({errors:e})=>[(0,l._)("div",I,[(0,l._)("img",{src:c.avatar,alt:""},null,8,F),(0,l._)("p",null,"Hi，"+(0,s.zw)(c.nickname)+" 欢迎来小兔鲜，完成绑定后可以QQ账号一键登录哦~",1)]),(0,l._)("div",H,[(0,l._)("div",U,[q,(0,l.Wm)(i,{class:(0,s.C_)([{err:e.mobile},"input"]),modelValue:c.form.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>c.form.mobile=e),name:"mobile",type:"text",placeholder:"绑定的手机号"},null,8,["class","modelValue"])]),e.mobile?((0,l.wg)(),(0,l.iD)("div",Z,(0,s.zw)(e.mobile),1)):(0,l.kq)("",!0)]),(0,l._)("div",P,[(0,l._)("div",W,[j,(0,l.Wm)(i,{class:(0,s.C_)([{err:e.code},"input"]),modelValue:c.form.code,"onUpdate:modelValue":a[1]||(a[1]=e=>c.form.code=e),name:"code",type:"text",placeholder:"短信验证码"},null,8,["class","modelValue"]),(0,l._)("span",{onClick:a[2]||(a[2]=e=>c.send()),class:"code"},(0,s.zw)(0===c.time?"发送验证码":`${c.time}秒后发送`),1)]),e.code?((0,l.wg)(),(0,l.iD)("div",z,(0,s.zw)(e.code),1)):(0,l.kq)("",!0)]),(0,l._)("a",{onClick:a[3]||(a[3]=e=>c.submit()),href:"javascript:;",class:"submit"},"立即绑定")])),_:1},8,["validation-schema"])}var $=o(5708),Q=o(2025),L=o(3430),N=o(65),S=o(2483),B={name:"CallbackBind",components:{Form:$.l0,Field:$.gN},props:{unionId:{type:String,default:""}},setup(e){const a=(0,C.iH)("null"),o=(0,C.iH)("null"),{proxy:s}=(0,l.FN)();g().Login.check()&&g().api("get_user_info").success((e=>{o.value=e.data.figureurl_qq_1,a.value=e.data.nickname}));const c=(0,C.qj)({mobile:null,code:null}),n={mobile:Q.Z.mobile,code:Q.Z.code},t=(0,C.iH)(null),i=(0,C.iH)(0),{pause:r,resume:u}=(0,L.Zv)((()=>{i.value--,i.value<=0&&r()}),1e3,!1);(0,l.Ah)((()=>{r()}));const d=async()=>{const e=n.mobile(c.mobile);!0===e?0===i.value&&(await(0,y.Oq)(c.mobile),s.$message({type:"success",text:"发送成功"}),i.value=60,u()):t.value.setFieldError("mobile",e)},m=(0,N.oR)(),p=(0,S.tv)(),v=async()=>{const a=t.value.validate();a&&(0,y.UA)({unionId:e.unionId,...c}).then((e=>{const{id:a,account:o,avatar:l,mobile:c,nickname:n,token:t}=e.result;m.commit("user/setUser",{id:a,account:o,avatar:l,mobile:c,nickname:n,token:t}),m.dispatch("cart/mergeCart").then((()=>{s.$message({type:"success",text:"QQ绑定成功"}),p.push(m.state.user.redirectUrl)}))})).catch((e=>{s.$message({type:"error",text:"绑定失败"})}))};return{nickname:a,avatar:o,form:c,mySchema:n,send:d,time:i,formCom:t,submit:v}}},R=o(89);const E=(0,R.Z)(B,[["render",A],["__scopeId","data-v-2b3c2558"]]);var K=E;const M=e=>((0,l.dD)("data-v-14082cbb"),e=e(),(0,l.Cn)(),e),O={class:"xtx-form-item"},Y={class:"field"},G=M((()=>(0,l._)("i",{class:"icon iconfont icon-user"},null,-1))),J={key:0,class:"error"},T={class:"xtx-form-item"},X={class:"field"},ee=M((()=>(0,l._)("i",{class:"icon iconfont icon-phone"},null,-1))),ae={key:0,class:"error"},oe={class:"xtx-form-item"},le={class:"field"},se=M((()=>(0,l._)("i",{class:"icon iconfont icon-code"},null,-1))),ce={key:0,class:"error"},ne={class:"xtx-form-item"},te={class:"field"},ie=M((()=>(0,l._)("i",{class:"icon iconfont icon-lock"},null,-1))),re={key:0,class:"error"},ue={class:"xtx-form-item"},de={class:"field"},me=M((()=>(0,l._)("i",{class:"icon iconfont icon-lock"},null,-1))),pe={key:0,class:"error"};function ve(e,a,o,c,n,t){const i=(0,l.up)("Field"),r=(0,l.up)("Form");return(0,l.wg)(),(0,l.j4)(r,{ref:"formCom","validation-schema":c.mySchema,class:"xtx-form",autocomplete:"off"},{default:(0,l.w5)((({errors:e})=>[(0,l._)("div",O,[(0,l._)("div",Y,[G,(0,l.Wm)(i,{class:(0,s.C_)([{err:e.account},"input"]),modelValue:c.form.account,"onUpdate:modelValue":a[0]||(a[0]=e=>c.form.account=e),name:"account",type:"text",placeholder:"请输入用户名"},null,8,["class","modelValue"])]),e.account?((0,l.wg)(),(0,l.iD)("div",J,(0,s.zw)(e.account),1)):(0,l.kq)("",!0)]),(0,l._)("div",T,[(0,l._)("div",X,[ee,(0,l.Wm)(i,{class:(0,s.C_)([{err:e.mobile},"input"]),modelValue:c.form.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>c.form.mobile=e),name:"mobile",type:"text",placeholder:"请输入手机号"},null,8,["class","modelValue"])]),e.mobile?((0,l.wg)(),(0,l.iD)("div",ae,(0,s.zw)(e.mobile),1)):(0,l.kq)("",!0)]),(0,l._)("div",oe,[(0,l._)("div",le,[se,(0,l.Wm)(i,{class:(0,s.C_)([{err:e.code},"input"]),modelValue:c.form.code,"onUpdate:modelValue":a[2]||(a[2]=e=>c.form.code=e),name:"code",type:"text",placeholder:"请输入验证码"},null,8,["class","modelValue"]),(0,l._)("span",{onClick:a[3]||(a[3]=e=>c.send()),class:"code"},(0,s.zw)(0===c.time?"发送验证码":`${c.time}秒后发送`),1)]),e.code?((0,l.wg)(),(0,l.iD)("div",ce,(0,s.zw)(e.code),1)):(0,l.kq)("",!0)]),(0,l._)("div",ne,[(0,l._)("div",te,[ie,(0,l.Wm)(i,{class:(0,s.C_)([{err:e.password},"input"]),modelValue:c.form.password,"onUpdate:modelValue":a[4]||(a[4]=e=>c.form.password=e),name:"password",type:"password",placeholder:"请输入密码"},null,8,["class","modelValue"])]),e.password?((0,l.wg)(),(0,l.iD)("div",re,(0,s.zw)(e.password),1)):(0,l.kq)("",!0)]),(0,l._)("div",ue,[(0,l._)("div",de,[me,(0,l.Wm)(i,{class:(0,s.C_)([{err:e.rePassword},"input"]),modelValue:c.form.rePassword,"onUpdate:modelValue":a[5]||(a[5]=e=>c.form.rePassword=e),name:"rePassword",type:"password",placeholder:"请确认密码"},null,8,["class","modelValue"])]),e.rePassword?((0,l.wg)(),(0,l.iD)("div",pe,(0,s.zw)(e.rePassword),1)):(0,l.kq)("",!0)]),(0,l._)("a",{onClick:a[6]||(a[6]=e=>c.submit()),href:"javascript:;",class:"submit"},"立即提交")])),_:1},8,["validation-schema"])}var fe={name:"CallbackPatch",components:{Form:$.l0,Field:$.gN},props:{unionId:{type:String,default:""}},setup(e){const{proxy:a}=(0,l.FN)(),o=(0,C.qj)({account:null,mobile:null,code:null,password:null,rePassword:null}),s={account:Q.Z.accountApi,mobile:Q.Z.mobile,code:Q.Z.code,password:Q.Z.password,rePassword:Q.Z.rePassword},c=(0,C.iH)(null),n=(0,C.iH)(0),{pause:t,resume:i}=(0,L.Zv)((()=>{n.value--,n.value<=0&&t()}),1e3,!1);(0,l.Ah)((()=>{t()}));const r=async()=>{const e=s.mobile(o.mobile);!0===e?0===n.value&&(await(0,y.N$)(o.mobile),a.$message({type:"success",text:"发送成功"}),n.value=60,i()):c.value.setFieldError("mobile",e)},u=(0,N.oR)(),d=(0,S.tv)(),m=async()=>{const l=c.value.validate();l&&(0,y.vi)({unionId:e.unionId,...o}).then((e=>{const{id:o,account:l,avatar:s,mobile:c,nickname:n,token:t}=e.result;u.commit("user/setUser",{id:o,account:l,avatar:s,mobile:c,nickname:n,token:t}),u.dispatch("cart/mergeCart").then((()=>{a.$message({type:"success",text:"QQ完善信息成功"}),d.push(u.state.user.redirectUrl)}))})).catch((e=>{a.$message({type:"error",text:"完善信息失败"})}))};return{form:o,mySchema:s,formCom:c,time:n,send:r,submit:m}}};const _e=(0,R.Z)(fe,[["render",ve],["__scopeId","data-v-14082cbb"]]);var be=_e,ke={name:"PageCallback",components:{LoginHeader:x.Z,LoginFooter:V.Z,CallbackBind:K,CallbackPatch:be},setup(){const{proxy:e}=(0,l.FN)(),a=(0,C.iH)(!0),o=(0,C.iH)(null),s=(0,C.iH)(null),c=(0,C.iH)(!0),n=(0,C.iH)(null),t=(0,N.oR)(),i=(0,S.tv)();return g().Login.check()&&g().Login.getMe((a=>{n.value=a,(0,y.K9)(a).then((a=>{const{id:o,account:l,avatar:s,mobile:n,nickname:r,token:u}=a.result;t.commit("user/setUser",{id:o,account:l,avatar:s,mobile:n,nickname:r,token:u}),c.value=!0,t.dispatch("cart/mergeCart").then((()=>{i.push(t.state.user.reDirectiveUrl),e.$message({type:"success",text:"QQ登录成功"})}))})).catch((e=>{console.log("qq登录失败"),c.value=!1}))})),{hasAccount:a,nickname:o,avatar:s,isBind:c,unionId:n}}};const he=(0,R.Z)(ke,[["render",h],["__scopeId","data-v-39cb7edc"]]);var we=he}}]);